# Ansible Playbook to delete Openstack Instances of Kubernetes cluster
# Note: Call with -i inventory/infra/hosts.ini
---
# Prepare CLI node: Un-mount NFS
- hosts: os-infra
  become: true
  tasks:
    - name: Unmount /opt/share in CLI
      mount:
        path: /opt/share
        fstype: nfs4
        state: "absent"

    - name: Delete DNS name from CLI
      copy:
        dest: "/etc/resolvconf/resolv.conf.d/head"
        content: |
          # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
          #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

    - name: Restart networking in CLI
      service:
        name: networking
        state: restarted

# Delete Instances
- hosts: os-infra
  roles:
    - { "role": os_instance, "delete": true }
